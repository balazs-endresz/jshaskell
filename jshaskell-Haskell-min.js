/*

 JSHaskell - Some Haskell language features for JavaScript

 http://code.google.com/p/jshaskell/

 Copyright (c) 2010 Balazs Endresz (balazs.endresz@gmail.com)
 Dual licensed under the MIT and GPL licenses.

 ------------------------------------------------------------

*/
(function(){(function(){function w(a,b){return V[a]=b||{}}function Ca(a,b){for(var c=V[a],d=0,e=b.length;d<e;++d){var g=V[a+"_"+b[d]];for(var f in g)c[f]=g[f]}}function Da(a){return Ea.call(a)=="[object Array]"}function W(a){return a!==I}function X(a,b){return a===b}function Y(a,b){return a!==b}function Fa(a,b){return a<b}function Ga(a,b){return a<=b}function Ha(a,b){return a>b}function Ia(a,b){return a>=b}function Ja(a){return-a}function J(a){var b=a.constructor;if(b)return b;a=typeof a;return a==
"string"?String:a=="number"?Number:a=="boolean"?Boolean:a=="function"?Function:I}function ha(a){function b(){var c=n(arguments);return c.length>=(a._length===I?a.length:a._length)?a.apply(null,c):function(){return b.apply(null,c.concat(n(arguments)))}}return b}function Z(a){return function(){return a}}function Ka(a){var b=n(arguments,1);return function(){return a.apply(null,b)}}function La(){function a(b){return!b?[]:[[b.name||b._name||b,b.arguments]].concat(a(b.caller))}return a(arguments.callee.caller)}
function o(a){a=(a instanceof Function?a.name||a._name:null)||a||"Unspecified error";var b=new Error(a);try{b.stackTrace=La()}catch(c){}b.message=a;throw b;}function Ma(a,b){for(var c in b)a[c]=b[c];return a}function Q(a,b){if(b.indexOf)return b.indexOf(a);var c=b.length;if(!c)return-1;for(var d=0;d<c;d++)if(b[d]===a)return d;return-1}function ia(a,b){if(b.lastIndexOf)return b.lastIndexOf(a);var c=b.length;if(!c)return-1;for(c=c-1;c>-1;--c)if(b[c]===a)return c;return-1}function Na(a){if(a.sort)return a.sort();
return n(a).sort().join("")}function $(a,b){for(var c=[],d=0,e=b.length;d<e;++d)c[d]=a(b[d]);return c}function Oa(a,b){for(var c=[],d=0,e=b.length;d<e;++d)a(b[d])&&c.push(b[d]);return c}function Pa(a,b,c){for(var d=0,e=c.length;d<e;++d)b=a(b,c[d]);return b}function Qa(a,b,c){for(var d=c.length-1;d>-1;--d)b=a(c[d],b);return b}function Ra(a,b){for(var c=[],d=0,e=Math.min(a.length,b.length);d<e;++d)c[d]=[a[d],b[d]];return c}function ja(a){function b(c,d){c=K.compare(c,d);return c.LT?-1:c.GT?1:c.EQ?0:
o(ja)}if(a.sort)return a.sort(b);return n(a).sort(b).join("")}function Sa(a){function b(c,d){var e=c.constructor==Array;x=e?c[0]:c.charAt(0);xs=e?c.slice(1):c.substr(1);return!c.length?[]:ka(x,d)?b(xs,d):R(x,b(xs,R(x,d)))}return b(a,[])}function Ta(a,b,c){if(c.Nothing)return a;if(c.Just)return b(c[0])}function Ua(a,b){return a===b?k.EQ:a<=b?k.LT:k.GT}function Va(a,b){return function(){return a(b.apply(null,arguments))}}function la(a,b){return function(c){var d=n(arguments,1);d.unshift(b(c));return a.apply(null,
d)}}function Wa(a){return function(b,c){return a(c,b)}}function R(a,b){if(typeof a=="string"&&typeof b=="string")return a+b;return[a].concat(b)}function Xa(a,b){if(typeof a=="string"&&typeof b=="string")return a+b;return a+b.join("")}function ma(a,b){for(var c=[],d=0;d<a;++d)c[d]=b;return c}function Ya(a){return!a.length}function Za(a,b){var c=b.constructor==Array;return a.constructor==Array?a.concat(c?b:b.split("")):a.concat(c?b.join(""):b)}function ka(a,b){return(b.indexOf?b.indexOf(a):Q(a,b))!=
-1}function $a(a){return/^\s$/.test(a)}function ab(a){return a.toUpperCase()==a}function bb(a){return a.toLowerCase()==a}function cb(a){return/^\w$/.test(a)}function db(a){return/^\w$/.test(a)&&/^\D$/.test(a)}function eb(a){return/^\d$/.test(a)}function fb(a){return/^[0-9A-Fa-f]$/.test(a)}function gb(a){return/^[0-7]$/.test(a)}function na(a){a=parseInt(a,16);return isNaN(a)?o(na):a}function hb(a,b){return{indexOf:function(c){return c>=a&&c<=b?true:-1},toString:function(){return"range("+a+", "+b+")"}}}
function ib(a){return a[0]}function jb(a){return a[1]}function kb(a){return function(b){return a(b[0],b[1])}}function lb(a,b){var c=b.length;if(!c)return L.Nothing;for(var d=0;d<c;++d)if(b[d][0]===a)return L.Just(b[d][1]);return L.Nothing}function mb(a){return parseInt(a.join?a.join(""):a,16)}function nb(a){return parseInt(a.join?a.join(""):a,8)}function aa(){this.keys=[];this.values=[]}function D(a,b){var c={};c._context=[];c._name=a;c._dict=new aa;c.context=function(){this._context=n(arguments);
delete c.context;return this};c.types=function(d){this._fnTypes=d;delete c.types;return this};c.impl=function(d){this._default=d;for(var e in c._fnTypes)(function(g,f){c[g]=f!==I&&f.constructor!=Array?(typeof d=="function"?d():d)[g]:function(){var i=arguments,h;if(f===I||f===E)o("There's no type signature for "+c._name+"."+g+", it can be accessed only by: getInstance("+c._name+", SomeType)."+g);var q,F=ba(function(p,r){r=f[r];if(q||r==E)return q=true;p=J(p);if(r==b){h=h||p;return h==p}else return p==
r},i);!q&&F.length!=f.length-1&&o("Type error in "+c._name+"."+g);(F=c._dict.get(h))||o("No "+c._name+" instance for "+(h.name||h._name));return F[g].apply(null,i)}})(e,c._fnTypes[e]);delete c.impl;return this};return c}function j(a,b,c){G(function(f){if(!f._dict.get(b))throw"No "+(f._name||"")+" instance for "+(b.name||b._name);},a._context);var d={};d._type=b;a._dict.put(b,d);c=typeof c=="function"?c(d):c||{};var e=a._default;e=typeof e=="function"?e(d):e;for(var g in a._fnTypes)d[g]=c[g]||e[g];
return d}function ob(a,b){return a._dict.get(b)}function pb(a,b,c){return a._dict.get(J(c))[b]}function qb(a){return["l",a]}function M(a){return["r",a]}function rb(a){return["x",a]}function sb(a){if(a)if(!a._String){var b=N[a];if(a._Op&&!b)return"l";return b&&(b.fixity[0]||"l")}}function tb(a){if(a)if(!a._String){var b=N[a];if(a._Op&&!b)return 9;return b&&(W(b.fixity[1])?b.fixity[1]:9)}}function ca(){}function da(a,b,c){var d;if(a[b]._Op){delete a[b]._Op;d=a[b]}else d=N[a[b]].func;d=d(a[b-1],a[b+
1]);a.splice(b-1,3,d);return z(a,c)}function ub(a){if(typeof a=="string"){a=new String(a);a._String=true;return a}else{a._Array=true;return a}}function vb(a){a._Op=true;return a}function z(a,b){a=G(function(h){if(!h)return h;if(h._Array){delete h._Array;return h}return h.constructor==Array?z(h,b):h.CallStream?h.resolve(b):h},a);if(b)a=$(function(h){return h instanceof ca?b:h},a);for(var c=[],d=[],e=0,g=a.length;e<g;++e){var f=a[e],i=false;if(N[f])i=true;if(f&&f._String){i=false;f=f.toString()}if(f&&
f._Op)i=true;if(!i&&e!=g-1)c.push(f);else{e==g-1&&c.push(f);c=c.length>1?c[0].apply(null,c.slice(1)):c[0];d.push(c);e!=g-1&&d.push(f);c=[]}}a=d;d=G(sb,a);g=G(tb,a);f=ba(W,g).sort().pop();e=Q(f,g);g=ia(f,g);return d[e]=="l"?da(a,e,b):d[g]=="r"?da(a,g,b):d[e]=="x"?da(a,e,b):a[0]}function wb(a){return function(){function b(){return e.apply(null,arguments)}function c(){return(g?e:c.resolve()).apply(null,arguments)}var d=arguments,e,g;c.resolve=function(f){if(g)return e;e=z(d,f||b);d=null;g=true;return e};
c.CallStream=true;c.constructor=a;return c}}function xb(){return z(n(arguments))}function S(a){this.scope=a}function oa(a){return function(){function b(){return e.apply(null,arguments)}function c(f){if(g||f instanceof S)return(g?e:c.resolve()).apply(null,arguments);d.push(z(arguments,b));return c}var d=[],e,g;d.push(z(arguments,b));c.resolve=function(){if(g)return e;e=a.do_.apply(null,d);g=true;d=null;return e};c.CallStream=true;c.constructor=a._type;return c}}function yb(a,b){return b?b[a]:function(c){return c[a]}}
function pa(){}function O(){}function qa(a){return function(){var b=[],c=this._recordset;if(c&&c.constructor!=Array){for(var d in c){var e=a?c[d].name||c[d]:this[d];if(!a&&e instanceof Function)e=e.constructor!=Function?e.constructor.name:"Function("+e.name+")";b.push(d+(a?" :: ":" = ")+e)}c=ma(this._dataConstructor.length+2," ").join("");b="{"+b.join("\n"+c+",")+"\n"+c+"}"}else{for(d=0;d in this;d++)b.push(a?c[d].name||c[d]:this[d]);b=b.join(" ")}return"("+this._dataConstructor+(b?" ":"")+b+")"}}
function ra(a,b,c,d,e){o("Type error: expecting "+a.name+" instead of "+b.name+" in the argument '"+c+"' of "+d+"."+e)}function P(a,b){function c(h,q){function F(zb,sa){var v=zb instanceof pa,s=new a,H,y;s.constructor=a;s._recordset=p&&q[0]||q;s._dataConstructor=h;s[h]=true;if(v)for(var t in sa){v=sa[t];p||o("Records are not defined for "+d+"."+h);t in r||o("The accessor '"+t+"' is not defined for "+d+"."+h);y=r[t];if(typeof y!="string"){H=J(v);H!=y&&ra(y,H,t,d,h)}s[t]=v;s[ta[t]]=v}else{t=arguments;
for(var A=0,Ab=t.length;A<Ab;++A){v=t[A];y=q[A];if(typeof y!="string"){H=J(v);H!=y&&ra(y,H,A,d,h)}s[A]=v;if(p)s[ua[A]]=v}}s.update=function(va){var wa={};for(var T in r)wa[T]=T in va?va[T]:this[T];return F(xa,wa)};return s}var p=q&&typeof q[0]=="object",r=p&&q[0];if(p){var ea=0,B,ta={},ua={};for(B in r){var fa=B.charAt(0);if(fa=="_"||fa==fa.toUpperCase())throw d+"."+i+"."+B+": record names can't start with underscore or uppercase letters";if(B in{update:1})throw d+"."+i+"."+B+": record name is invalid";
ta[B]=ea;ua[ea]=B;ea++}}return F}var d=a.name;if(a._constructors)throw"Type constructor has been already defined: '"+d+"'";a._constructors=b;a.prototype=new O;for(var e=0,g=b.length;e<g;++e){var f=typeof b[e]!="object",i=f?b[e]:b[e][0];if(i in a)throw"The name of the data constructor ("+d+"."+i+") is invalid!";a[i]=f?c(i)():c(i,n(b[e],1));if(!f)a[i]._length=b[e].length-1}}function Bb(a){a.constructor=C["Tuple"+a.length];return a}function ya(){}function L(){}function k(){}function za(){}var l=function(){return this}()||
window,V=l.NS||(l.NS={});l.JSParsec={};var I,Ea={}.toString,ga=[].slice,Aa=[].map,Ba=[].filter;(function(){return this}).toString().indexOf("this");(function(){var a={9:1,d:1,b:1,0:1,a:1,c:1},b=[9,"d","b",0,"a","c"],c=0;for(var d in a)if(d!=b[c++])return false;return true})();l.global=l;l.namespace=w;l.importSubmodules=Ca;l=function(a){return a};var U=ha(function(a,b){return a(b)}),n="a"[0]?function(a,b){return ga.call(a,b||0)}:function(a,b){if(typeof a=="string"){a=a.split("");if(!b)return a}return ga.call(a,
b||0)},G=Aa?function(a,b){return Aa.call(b,a)}:function(a,b){for(var c=[],d=0,e=b.length;d<e;++d)c[d]=a(b[d],d,b);return c},ba=Ba?function(a,b){return Ba.call(b,a)}:function(a,b){for(var c=[],d=0,e=b.length;d<e;++d)a(b[d],d,b)&&c.push(b[d]);return c};w("Haskell_Main",{curry:ha,const_:Z,isArray:Da,isDefined:W,slice:n,foldl:Pa,foldr:Qa,map:$,imap:G,filter:Oa,ifilter:ba,indexOf:Q,lastIndexOf:ia,zip:Ra,sort:ja,isort:Na,nub:Sa,maybe:Ta,compare:Ua,compose:Va,compose1:la,call:U,id:l,flip:Wa,cons:R,consJoin:Xa,
replicate:ma,negate:Ja,null_:Ya,elem:ka,isSpace:$a,isUpper:ab,isLower:bb,isAlpha:db,isAlphaNum:cb,isDigit:eb,isHexDigit:fb,isOctDigit:gb,digitToInt:na,range:hb,extend:Ma,namespace:w,toInteger:parseInt,fromInteger:l,fromIntegral:l,fst:ib,snd:jb,uncurry:kb,lookup:lb,readHex:mb,readOct:nb,chr:String.fromCharCode,round:Math.round,typeOf:J});aa.prototype.put=function(a,b){this.keys.push(a);this.values.push(b)};aa.prototype.get=function(a){a=Q(a,this.keys);if(a!=-1)return this.values[a]};var E={};w("Haskell_Typeclass",
{typeclass:D,VARARG:E,instance:j,getInstance:ob,asTypeOf:pb});var N={$:{func:U,fixity:M(0)},".":{func:la,fixity:M(9)},":":{func:R,fixity:M(5)},"++":{func:Za,fixity:M(5)}};l=new ca;w("Haskell_Expression",{operators:N,infix:rb,infixl:qb,infixr:M,op:vb,no:ub,resolve:z,recurse:l,Recurse:ca,exl:wb,exs:xb});w("Haskell_Do",{createDo:oa});var xa=new pa;O.prototype.toString=qa();O.prototype.dataConstructorToString=qa(true);O.prototype.update=Ka(o);w("Haskell_ADT",{data:P,ADT:O,record:xa,accessor:yb,accessors:{}});
var C={};G(function(a){var b="Tuple"+a;C[b]=function(){};C[b]._name=b;C["tuple"+a]=function(c){c.constructor=C[b];return c}},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]);C.tuple=Bb;P(ya,["Unit"]);P(L,[["Just","a"],"Nothing"]);P(k,["LT","EQ","GT"]);P(za,[["Left","a"],["Right","b"]]);var m=D("Eq","a").types({eq:["a","a",Boolean],ne:["a","a",Boolean]}).impl(function(a){return{eq:function(b,c){return!a.ne(b,c)},ne:function(b,c){return!a.eq(b,c)}}});j(m,Number,{eq:X,ne:Y});j(m,String,{eq:X,ne:Y});j(m,Boolean,
{eq:X,ne:Y});j(m,RegExp,{eq:function(a,b){return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline}});j(m,Array,{eq:function(a,b){var c=a.length;if(c!=b.length)return false;for(var d=0;d<c;++d)if(!m.eq(a[d],b[d]))return false;return true}});j(m,Object,{eq:function(a,b){var c,d={};for(c in a)d[c]=true;for(c in b)d[c]=true;for(c in d)if(!m.eq(a[c],b[c]))return false;return true}});j(m,k,{eq:function(a,b){return a.EQ&&b.EQ?true:a.LT&&b.LT?true:a.GT&&b.GT?
true:false}});var K=D("Ord","a").context(m).types({compare:["a","a",k],"<":["a","a",Boolean],"<=":["a","a",Boolean],">":["a","a",Boolean],">=":["a","a",Boolean],max:["a","a","a"],min:["a","a","a"]}).impl(function(a){return{compare:function(b,c){return m.eq(b,c)?k.EQ:a["<="](b,c)?k.LT:k.GT},"<":function(b,c){return a.compare(b,c).LT?true:false},"<=":function(b,c){return a.compare(b,c).GT?false:true},">":function(b,c){return a.compare(b,c).GT?true:false},">=":function(b,c){return a.compare(b,c).LT?
false:true},max:function(b,c){return a["<="](b,c)?c:b},min:function(b,c){return a["<="](b,c)?b:c}}});j(K,Boolean,{compare:function(a,b){return a===true&&b===false?k.LT:a===false&&b===true?k.GT:k.EQ}});j(K,Number,{compare:function(a,b){return a===b?k.EQ:a<=b?k.LT:k.GT},"<":Fa,"<=":Ga,">":Ha,">=":Ia,max:function(a,b){return a<=b?b:a},min:function(a,b){return a<=b?a:b}});j(K,k,{"<=":function(a,b){return a.LT?true:b.LT?false:a.EQ?true:b.EQ?false:a.GT&&b.GT?true:o()}});l=D("Functor","f").types({fmap:[Function,
"f","f"],"<$":["a","f","f"]}).impl(function(a){return{"<$":function(b,c){return a.fmap(Z(b),c)}}});U=D("Monad","m").types({">>=":["m",Function,"m"],">>":["m","m","m"],return_:["a","m"],fail:[String,"m"],do_:E,do$:E,run:E}).impl(function(a){return{">>":function(b,c){b=a[">>="](b,Z(c));b.constructor=a._type;return b},fail:function(b){return o(b)},do_:function(){function b(e){for(var g=new S(e),f=1,i=c.length,h=c[0];f<i;++f)h=d(h,c[f]);f=ga.call(arguments,1);f.unshift(g);return h.apply(null,f)}var c=
arguments,d=a[">>"];b.constructor=a._type;return b},run:function(b){var c=n(arguments,1);c.unshift(new S);return b.apply(null,c)},do$:oa(a)}});var u=D("Show","a").types({show:["a",String]}).impl({show:function(a){return a.toString()}});j(u,Number);j(u,Boolean);j(u,RegExp);j(u,Function,{show:function(a){var b=a.name||a._name||"\u03bb";if(a.constructor)return b+" :: "+a.constructor.name;a=(a=a.toString().match(/\([^\)]*\)/))&&a[0]||"";return b+a}});j(u,String,{show:function(a){return'"'+a.toString()+
'"'}});j(u,Array,{show:function(a){return typeof a[0]==String?'"'+a.join("")+'"':"["+$(u.show,a).join(", ")+"]"}});j(u,Object,{show:function(a){var b=[];for(var c in a)b.push("  "+c+": "+u.show(a[c]));return"{\n"+a.join(",\n")+"\n}"}});w("Haskell_DataTypes",{Unit:ya,Tuple:C,Maybe:L,Ordering:k,Either:za,Eq:m,Ord:K,Functor:l,Monad:U,Scope:S,Show:u})})();(function(){namespace("Haskell");importSubmodules("Haskell",["Main","ADT","Typeclass","Expression","Do","DataTypes"])})()})();
